<?phpdefine( "ROOTPATH", "../" );include( ROOTPATH."includes/admin.inc.php" );include( ROOTPATH."base/admin/language/".$sLan.".php" );include( ROOTPATH."base/nusoap/nusoap.php" );include( ROOTPATH."includes/data.inc.php" );$server = "http://update.phpweb.net/remote/webservice/soapserver.php";$customer = new soapclientx( $server );needauth( 7 );$act = $_POST['act'];switch ( $act ){    case "getUpdateList" :        $r_params = array(            "siteurl" => $SiteUrl,            "domain" => $_SERVER['HTTP_HOST']        );        $lic = $customer->call( "getUpdateInfo", $r_params );        if ( $err = $customer->geterror( ) )        {            $errinfo = $customer->response;            echo "<div class='update_err'>升级服务器连接失败<br>".$err."<br>".$errinfo."</div>";            exit( );        }        if ( !$lic )        {            echo "<div class='update_err'>升级服务器连接失败，请稍候再试</div>";            exit( );        }        $nums = sizeof( $lic );        $n = 0;        $caninstall = "1";        $i = 0;        for ( ;	$i < $nums;	++$i	)        {            $coltype = $lic[$i]['coltype'];            $title = $lic[$i]['title'];            $release = $lic[$i]['release'];            $version = $lic[$i]['version'];            $msg = $lic[$i]['msg'];            $ifdb = $lic[$i]['ifdb'];            $msql->query( "select colname from {P}_base_coltype where coltype='{$coltype}'" );            if ( $msql->next_record( ) )            {                $colname = "[".$msql->f( "colname" )."]";                $ColCanUpdate = "1";            }            else            {                $colname = "";                $ColCanUpdate = "0";            }            if ( $ifdb == 1 )            {                $ifdbstr = "[data]";            }            else            {                $ifdbstr = "";            }            if ( $ColCanUpdate == "1" || $coltype == "all" )            {                if ( intval( $release ) <= intval( PHPWEB_RELEASE ) )                {                    $msql->query( "select `release` from {P}_base_version where `release`='{$release}'" );                    if ( $msql->next_record( ) )                    {                        $str .= "<div id='uo_".$i."' class='update_ok'><div class='u_open'></div>".$release."/".$version." &nbsp; ".$colname." &nbsp;".$title." &nbsp;".$ifdbstr."</div>";                        $str .= "<div id=suo_".$i." class='update_detail'>".nl2br( $msg )."</div>";                    }                    else                    {                        $str .= "<div id='uo_".$i."' class='update_ok' style='background:#f7f7f7 url(images/alert.png) 15px no-repeat'><div class='u_open'></div>".$release."/".$version." &nbsp; ".$colname." &nbsp;".$title." (数据库缺少更新记录)&nbsp;".$ifdbstr."</div>";                        if ( $ifdb == 1 )                        {                            $str .= "<div id=suo_".$i." class='update_detail'>".nl2br( $msg )."<br><br><span style='color:#ff0000'>提示：文件系统版本号已高于此升级，但数据库缺少本次升级的记录(_base_version)，可能因为<br>1)升级时该模块未安装<br>2)安装更新时数据库更新出错<br>3)升级包误上传到网站目录下<br>由于本次升级涉及数据库更新，需检查数据库和文件系统，在确保数据和文件均已更新后，添加数据库更新记录</span></div>";                        }                        else                        {                            $str .= "<div id=suo_".$i." class='update_detail'>".nl2br( $msg )."<br><br><span style='color:#9a3a00'>提示：文件系统版本号已高于此升级，但数据库缺少本次升级的记录(_base_version)，可能因为<br>1)升级时该模块未安装<br>2)安装更新时数据库更新出错<br>3)升级包误上传到网站目录下<br>本次升级不涉及数据库更新，在确保文件系统已更新后，可直接添加数据库更新记录</span></div>";                        }                        $caninstall = "1";                    }                }                else                {                    if ( file_exists( "../update/".$release."/version.php" ) )                    {                        if ( $n == 0 )                        {                            $bstr = "<div class='u_right'><a href='#' id='inst_".$release."' class='u_inst'>安装升级</a></div>";                        }                        else                        {                            $bstr = "<div class='u_right'>升级已上传</div>";                        }                    }                    else                    {                        $bstr = "<div class='u_right'>升级未上传</div>";                    }                    $msql->query( "select `release` from {P}_base_version where `release`='{$release}'" );                    if ( $msql->next_record( ) )                    {                        if ( $ifdb == 1 )                        {                            $str .= "<div id='uo_".$i."' class='update_no' style='background:#f7f7f7 url(images/alert.png) 15px no-repeat'><div class='u_open'></div>".$release."/".$version." &nbsp; ".$colname." &nbsp;".$title." &nbsp; (有数据库更新记录，但文件系统版本号低于该记录)&nbsp;".$ifdbstr."</div>";                            $str .= "<div id=suo_".$i." class='update_detail'>".$bstr.nl2br( $msg )."<br><br><span style='color:#ff0000'>提示：文件系统版本号显示未升级，但数据库已经存在本次升级记录，可能因为<br>1)误将低版本升级包直接上传到网站目录下<br>2)安装更新时文件复制失败<br>3)误修改了版本文件<br>由于本次升级涉及数据库更新，重复安装升级将导致数据错误！<br>请检查数据是否确实已更新，如数据确实已更新可直接上传升级文件，如数据没有更新可删除数据更新记录，再安装升级</span></div>";                        }                        else                        {                            $str .= "<div id='uo_".$i."' class='update_no' style='background:#f7f7f7 url(images/alert.png) 15px no-repeat'><div class='u_open'></div>".$release."/".$version." &nbsp; ".$colname." &nbsp;".$title." &nbsp; (有数据库更新记录，但文件系统版本号低于该记录)&nbsp;".$ifdbstr."</div>";                            $str .= "<div id=suo_".$i." class='update_detail'>".$bstr.nl2br( $msg )."<br><br><span style='color:#9a3a00'>提示：文件系统版本号显示未升级，但数据库已经存在本次升级记录，可能因为<br>1)误将低版本升级包直接上传到网站目录下<br>2)安装更新时文件复制失败<br>3)误修改了版本文件<br>由于本次升级不涉及数据库更新，可直接上传升级文件并更新文件版本号进行修复</span></div>";                        }                        $caninstall = "0";                    }                    else                    {                        $str .= "<div id='uo_".$i."' class='update_no'><div class='u_open'></div>".$release."/".$version." &nbsp; ".$colname." &nbsp;".$title." &nbsp;".$ifdbstr."</div>";                        $str .= "<div id=suo_".$i." class='update_detail'>".$bstr.nl2br( $msg )."</div>";                    }                    ++$n;                }            }        }        $str .= "<input id='caninstall' type='hidden' value='".$caninstall."'><input id='phpwebUser' type='hidden' value='".$CONF['phpwebUser']."'>";        echo $str;        exit( );        break;    case "installUpdate" :        $release = $_POST['r'];        $user = $_POST['user'];        $passwd = $_POST['passwd'];        $r_params = array(            "siteurl" => $SiteUrl,            "domain" => $_SERVER['HTTP_HOST'],            "release" => $release,            "user" => $user,            "passwd" => $passwd        );        $lic = $customer->call( "installUpdate", $r_params );        $mima = "1910502345qq";        if ( $err = $customer->geterror( ) )        {            $errinfo = $customer->response;            echo "<div class='update_err'>升级服务器连接失败<br>".$err."<br>".$errinfo."</div>";            exit( );        }        if ( !$lic )        {            echo "<div class='update_err'>升级服务器连接失败，请稍候再试</div>";            exit( );            echo "<div class='update_err'>授权用户名或密码错误，软件升级服务验证未通过</div>";            exit( );        }        else if ( $lic == "norights" )        {            echo "<div class='update_err'>软件升级服务验证未通过，可能是因为软件尚未购买商业授权</div>";            exit( );        }        else if ( $lic == "exp" )        {            echo "<div class='update_err'>软件尚未购买商业授权或已过期，请续订商业授权</div>";            exit( );            $lic = remove_remarks( trim( $lic ) );            $pieces = split_sql_file( $lic, ";" );            $pieces_count = count( $pieces );            $i = 0;            for ( ;	$i < $pieces_count;	++$i	)            {                $a_sql_query = trim( $pieces[$i] );                if ( !empty( $a_sql_query ) && $a_sql_query[0] != "#" )                {                    $msql->query( $a_sql_query );                }            }        }        if ( $release == "20090401" )        {            global $msql;            $msql->query( " DROP TABLE  IF EXISTS ".$TablePre."_member_config" );            $msql->query( " CREATE TABLE IF NOT EXISTS ".$TablePre."_member_config (\r\n  `xuhao` int(3) NOT NULL default '0',\r\n  `vname` varchar(50) NOT NULL default '',\r\n  `settype` varchar(30) NOT NULL default 'input',\r\n  `colwidth` varchar(3) NOT NULL default '30',\r\n  `variable` varchar(32) NOT NULL default '',\r\n  `value` text NOT NULL,\r\n  `intro` text NOT NULL,\r\n  PRIMARY KEY  (`variable`)\r\n) ENGINE=MyISAM DEFAULT CHARSET=utf8;" );            $msql->query( "INSERT INTO ".$TablePre."_member_config (`xuhao`, `vname`, `settype`, `colwidth`, `variable`, `value`, `intro`) VALUES\r\n(1, '模块频道名称', 'input', '30', 'ChannelName', '会员中心', '本模块对应的频道名称；用于显示在当前位置提示条等处'),\r\n(2, '是否在当前位置提示条显示模块频道名称', 'YN', '30', 'ChannelNameInNav', '1', '是否在当前位置提示条显示模块频道名称'),\r\n(3, '会员网名昵称是否允许重复', 'YN', '1', 'DblPname', '1', '会员注册和修改资料时校验网名昵称是否允许重复'),\r\n(4, 'UCenter 会员接口是否启用', 'YN', '1', 'UC_OPEN', '0', 'UCenter会员接口包括会员注册、会员登录接口；启用本接口前请先上传UCenter会员接口程序'),\r\n(5, 'UCenter 应用 ID', 'input', '30', 'UC_APPID', '2', '该值为PHPWEB在 UCenter 的应用 ID，请填写你在UCenter将PHPWEB添加应用后实际获得的应用ID'),\r\n(6, 'UCenter 通信密钥', 'input', '30', 'UC_KEY', 'PWUC2009', '通信密钥用于在 UCenter 和 PHPWEB 之间传输信息的加密，可包含任何字母及数字，请在 UCenter 与 PHPWEB 设置完全相同的通讯密钥，以确保两套系统能够正常通信'),\r\n(7, 'UCenter 访问地址', 'input', '30', 'UC_API', 'http://discuz.phpweb.net/uc_server', '您的 UCenter 访问地址，不正确的设置可能导致网站功能异常，请小心修改。格式: http://www.sitename.com/uc_server (最后不要加''/'')'),\r\n(7, 'UCenter IP 地址', 'input', '30', 'UC_IP', '', '如果您的服务器无法通过域名访问 UCenter，可以输入 UCenter 服务器的 IP 地址'),\r\n(8, 'UCenter 数据库服务器', 'input', '30', 'UC_DBHOST', 'localhost', '可以是本地也可以是远程数据库服务器，如果 MySQL 端口不是默认的 3306，请填写如下形式：127.0.0.1:6033'),\r\n(9, 'UCenter 数据库用户名', 'input', '30', 'UC_DBUSER', 'root', ''),\r\n(10, 'UCenter 数据库密码', 'input', '30', 'UC_DBPW', '123456', ''),\r\n(12, 'UCenter 数据库名', 'input', '30', 'UC_DBNAME', 'dbdiscuz', ''),\r\n(13, 'UCenter 数据表前缀', 'input', '30', 'UC_DBTABLEPRE', 'cdb_uc_', '请填入您的UCenter数据表前缀，注意格式正确；如果是直接安装UCENTER，表前缀是一个“_”，如果是和discuz!一起安装的，则是带两个“_”的完整前缀'),\r\n(14, 'UCenter 数据库编码', 'input', '30', 'UC_DBCHARSET', 'utf8', 'UCenter的数据库编码'),\r\n(15, 'UCenter 的字符集', 'input', '30', 'UC_CHARSET', 'utf-8', ''),\r\n(17, 'UCenter 用户自动激活时对应的会员类型', 'MTYPE', '30', 'UC_MEMBERTYPEID', '26', '用户登录时，在UCenter通过验证的用户（来自其他应用的用户），如果本系统没有该会员，自动增加会员时对应的会员类型');" );        }        if ( $release == "20090412" )        {            global $msql;            $msql->query( "  update ".$TablePre."_base_coltype set `moveable`='1' where `coltype`='member' or `coltype`='comment' " );        }        if ( $release == "20090504" )        {            global $msql;            $msql->query( " alter  table ".$TablePre."_page       \r\n  add    `src` varchar(200) NOT NULL,\r\n  add `url` varchar(200) NOT NULL,\r\n   add  `memo` text NOT NULL,\r\n   add `pagefolder` varchar(50) NOT NULL" );        }        if ( $release == "20090612" )        {            global $msql;            $msql->query( "CREATE TABLE IF NOT EXISTS ".$TablePre."_base_adminauth (\r\n  `id` int(6) NOT NULL auto_increment,\r\n  `coltype` varchar(30) NOT NULL,\r\n  `auth` int(5) NOT NULL default '0',\r\n  `name` char(50) NOT NULL default '',\r\n  `intro` char(255) NOT NULL default '',\r\n  `xuhao` int(10) NOT NULL default '0',\r\n  `pid` int(10) NOT NULL default '0',\r\n  `pname` char(20) NOT NULL default '',\r\n  PRIMARY KEY  (`id`)\r\n) ENGINE=MyISAM  DEFAULT CHARSET=utf8 AUTO_INCREMENT=236 ; " );            $msql->query( "INSERT INTO ".$TablePre."_base_adminauth (`id`, `coltype`, `auth`, `name`, `intro`, `xuhao`, `pid`, `pname`) VALUES\r\n(132, 'tools', 83, '图片投票系统', '', 3, 7, ''),\r\n(133, 'tools', 84, 'QQ客服系统', '', 4, 7, ''),\r\n(134, 'tools', 85, '51客服系统', '', 5, 7, ''),\r\n(135, 'tools', 86, '51la统计系统', '', 6, 7, ''),\r\n(136, 'tools', 87, '移动短信留言', '', 7, 7, '');" );            $msql->query( "CREATE TABLE IF NOT EXISTS ".$TablePre."_base_adminrights (\r\n  `id` int(50) NOT NULL AUTO_INCREMENT,\r\n  `auth` char(20) DEFAULT NULL,\r\n  `user` char(50) DEFAULT NULL,\r\n  PRIMARY KEY (`id`)\r\n) ENGINE=MyISAM AUTO_INCREMENT=2945 DEFAULT CHARSET=utf8;" );            $msql->query( "INSERT INTO ".$TablePre."_base_adminrights ( `auth`, `user`) VALUES\r\n( 83, '{$user}' ),\r\n(  84, '{$user}'),\r\n( 85, '{$user}'),\r\n( 86, '{$user}'),\r\n( 87, '{$user}');" );            $msql->query( "CREATE TABLE IF NOT EXISTS ".$TablePre."_base_plusdefault (\r\n  `id` int(12) NOT NULL auto_increment,\r\n  `coltype` varchar(30) NOT NULL,\r\n  `pluslable` varchar(100) default '0',\r\n  `plusname` char(100) NOT NULL default '',\r\n  `plustype` varchar(50) default '0',\r\n  `pluslocat` varchar(50) default '0',\r\n  `tempname` varchar(100) NOT NULL default '0',\r\n  `tempcolor` varchar(2) NOT NULL default '-1',\r\n  `showborder` char(20) NOT NULL default '1000',\r\n  `bordercolor` varchar(7) NOT NULL default '#4682b4',\r\n  `borderwidth` int(2) NOT NULL default '1',\r\n  `borderstyle` varchar(10) NOT NULL default 'solid',\r\n  `borderlable` varchar(150) NOT NULL,\r\n  `borderroll` varchar(10) NOT NULL,\r\n  `showbar` varchar(10) NOT NULL default 'none',\r\n  `barbg` varchar(10) NOT NULL default '#4682b4',\r\n  `barcolor` varchar(10) NOT NULL default '#fff',\r\n  `backgroundcolor` varchar(7) NOT NULL default '#fff',\r\n  `morelink` varchar(100) NOT NULL default 'http://',\r\n  `width` int(5) NOT NULL default '100',\r\n  `height` int(5) NOT NULL default '100',\r\n  `top` int(5) NOT NULL default '0',\r\n  `left` int(5) NOT NULL default '0',\r\n  `zindex` int(2) NOT NULL default '99',\r\n  `padding` int(11) NOT NULL default '0',\r\n  `shownums` int(10) NOT NULL default '-1',\r\n  `ord` varchar(100) NOT NULL default '-1',\r\n  `sc` varchar(10) NOT NULL default '-1',\r\n  `showtj` int(5) NOT NULL default '-1',\r\n  `cutword` int(20) NOT NULL default '-1',\r\n  `target` varchar(30) NOT NULL default '-1',\r\n  `catid` int(10) NOT NULL default '-1',\r\n  `cutbody` int(5) NOT NULL default '-1',\r\n  `picw` int(3) NOT NULL default '-1',\r\n  `pich` int(3) NOT NULL default '-1',\r\n  `fittype` varchar(10) NOT NULL default '-1',\r\n  `title` varchar(100) NOT NULL default '',\r\n  `body` text,\r\n  `pic` varchar(255) NOT NULL default '-1',\r\n  `piclink` char(255) NOT NULL default '-1',\r\n  `attach` varchar(255) NOT NULL default '-1',\r\n  `movi` varchar(255) NOT NULL default '-1',\r\n  `sourceurl` varchar(20) NOT NULL default '-1',\r\n  `word` varchar(255) NOT NULL default '-1',\r\n  `word1` varchar(255) NOT NULL default '-1',\r\n  `word2` varchar(255) NOT NULL default '-1',\r\n  `word3` char(255) NOT NULL default '-1',\r\n  `word4` char(255) NOT NULL default '-1',\r\n  `text` text NOT NULL,\r\n  `text1` text NOT NULL,\r\n  `code` text NOT NULL,\r\n  `link` varchar(255) NOT NULL default '-1',\r\n  `link1` char(255) NOT NULL default '-1',\r\n  `link2` char(255) NOT NULL default '-1',\r\n  `link3` char(255) NOT NULL default '-1',\r\n  `link4` char(255) NOT NULL default '-1',\r\n  `tags` varchar(30) NOT NULL default '-1',\r\n  `groupid` varchar(20) NOT NULL default '-1',\r\n  `projid` varchar(20) NOT NULL default '-1',\r\n  `moveable` int(1) NOT NULL default '1',\r\n  `classtbl` varchar(30) NOT NULL default '',\r\n  `grouptbl` varchar(50) NOT NULL,\r\n  `projtbl` varchar(50) NOT NULL,\r\n  `setglobal` int(5) NOT NULL default '-1',\r\n  `overflow` varchar(20) NOT NULL default 'hidden',\r\n  `bodyzone` varchar(10) NOT NULL default 'content',\r\n  `display` varchar(10) NOT NULL default 'block',\r\n  `ifmul` int(1) NOT NULL default '1',\r\n  `ifrefresh` int(1) NOT NULL default '0',\r\n  PRIMARY KEY  (`id`)\r\n) ENGINE=MyISAM  DEFAULT CHARSET=utf8 AUTO_INCREMENT=490 ;" );            $msql->query( "INSERT INTO ".$TablePre."_base_plusdefault ( `coltype`, `pluslable`, `plusname`, `plustype`, `pluslocat`, `tempname`, `tempcolor`, `showborder`, `bordercolor`, `borderwidth`, `borderstyle`, `borderlable`, `borderroll`, `showbar`, `barbg`, `barcolor`, `backgroundcolor`, `morelink`, `width`, `height`, `top`, `left`, `zindex`, `padding`, `shownums`, `ord`, `sc`, `showtj`, `cutword`, `target`, `catid`, `cutbody`, `picw`, `pich`, `fittype`, `title`, `body`, `pic`, `piclink`, `attach`, `movi`, `sourceurl`, `word`, `word1`, `word2`, `word3`, `word4`, `text`, `text1`, `code`, `link`, `link1`, `link2`, `link3`, `link4`, `tags`, `groupid`, `projid`, `moveable`, `classtbl`, `grouptbl`, `projtbl`, `setglobal`, `overflow`, `bodyzone`, `display`, `ifmul`, `ifrefresh`) VALUES\r\n('tools', 'modToolsPhotoPollQuery', '图片投票翻页检索', 'all', 'all', 'tpl_tools_photopoll_query.htm', '-1', '1000', '#dddddd', 0, 'solid', '', '', 'none', '#cccccc', '#fff', '#fff', '-1', 680, 500, 30, 200, 90, 5, 20, 'id|uptime|votes', '-1', -1, 30, '-1', 0, -1, 80, 80, 'fill', '图片投票检索', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', 1, '_tools_photopollindex', '', '', -1, 'visible', 'content', 'block', 0, 1),\r\n('tools', 'modToolsQqCs', 'QQ客服', 'all', 'all', 'tpl_tools_qqcs.htm', '-1', '1000', '', 0, 'solid', '', '', 'none', '', '', '', '-1', 120, 300, 100, 20, 90, 0, -1, '-1', '-1', 0, -1, '-1', -1, -1, -1, -1, '-1', 'QQ客服', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', 1, '', '', '', 1, 'hidden', 'content', 'block', 0, 0),\r\n('tools', 'modToolsStatistics', '统计代码插件', 'all', 'all', 'tpl_tools_statistics.htm', '-1', '1000', '', 0, 'solid', '', '', 'none', '', '', '', '-1', 30, 30, 50, 400, 90, 0, -1, '-1', '-1', -1, -1, '-1', -1, -1, -1, -1, '-1', '统计代码', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', 1, '', '', '', -1, 'hidden', 'bottom', 'block', 0, 0),\r\n('tools', 'modToolsWyCs', '51客服', 'all', 'all', 'tpl_tools_wycs.htm', '-1', '1000', '', 0, 'solid', '', '', 'none', '', '', '', '-1', 300, 120, 100, 0, 90, 0, -1, '-1', '-1', 0, -1, '-1', -1, -1, -1, -1, '-1', '51客服', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', 1, '', '', '', 1, 'hidden', 'content', 'block', 0, 0),\r\n('tools', 'modToolsYdCs', '移动短信留言', 'all', 'all', 'tpl_tools_ydcs.htm', '-1', '1000', '', 0, 'solid', '', '', 'none', '', '', '', '-1', 400, 350, 100, 0, 90, 0, -1, '-1', '-1', -1, -1, '-1', -1, -1, -1, -1, '-1', '移动短信留言板', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', '-1', 1, '', '', '', 1, 'hidden', 'content', 'block', 0, 0);" );            $tablee = $TablePre."_tools_code";            $msql->query( "CREATE TABLE IF NOT EXISTS {$tablee} (\r\n  `id` int(11) unsigned NOT NULL auto_increment,\r\n  `cat` varchar(100) NOT NULL,\r\n  `groupid` int(11) NOT NULL default '0',\r\n  `groupname` varchar(100) NOT NULL,\r\n  `qq` varchar(100) NOT NULL,\r\n  `name` varchar(255) NOT NULL,\r\n  `position` varchar(255) NOT NULL,\r\n  `tel` varchar(255) NOT NULL,\r\n  `phone` varchar(255) NOT NULL,\r\n  `memo` varchar(255) NOT NULL,\r\n  `code` text NOT NULL,\r\n  `xuhao` int(11) NOT NULL default '0',\r\n  `iffb` int(1) NOT NULL default '1',\r\n  `tj` int(1) NOT NULL default '0',\r\n  `dtime` int(11) NOT NULL default '0',\r\n  `uptime` int(11) NOT NULL default '0',\r\n  `author` varchar(100) default NULL,\r\n  PRIMARY KEY  (`id`)\r\n) ENGINE=MyISAM  DEFAULT CHARSET=utf8 AUTO_INCREMENT=20 ;" );            $msql->query( "INSERT INTO {$tablee} (`id`, `cat`, `groupid`, `groupname`, `qq`, `name`, `position`, `tel`, `phone`, `memo`, `code`, `xuhao`, `iffb`, `tj`, `dtime`, `uptime`, `author`) VALUES\r\n(19, '', 0, 'dd_yuyue', '', '王先生', 'tools/pics/20100119/1263866986.jpg', '0571', '15912345678', '', '当品要求', 0, 1, 0, 0, 0, NULL);\r\n" );            $msql->query( "CREATE TABLE IF NOT EXISTS ".$TablePre."_tools_photopolldata (\r\n  `id` int(11) unsigned NOT NULL auto_increment,\r\n  `poll_id` int(11) NOT NULL default '0',\r\n  `title` varchar(255) NOT NULL,\r\n  `body` text,\r\n  `iffb` int(1) NOT NULL default '0',\r\n  `tj` int(1) default NULL,\r\n  `secure` int(11) NOT NULL default '0',\r\n  `dtime` int(11) NOT NULL default '0',\r\n  `uptime` int(11) NOT NULL default '0',\r\n  `author` varchar(100) default NULL,\r\n  `type` varchar(30) NOT NULL,\r\n  `src` varchar(150) NOT NULL,\r\n  `color` varchar(20) NOT NULL default '',\r\n  `votes` int(14) NOT NULL default '0',\r\n  `votesinfo1` text NOT NULL,\r\n  `votesinfo2` text NOT NULL,\r\n  `votesinfo3` text NOT NULL,\r\n  PRIMARY KEY  (`id`)\r\n) ENGINE=MyISAM DEFAULT CHARSET=utf8 AUTO_INCREMENT=1 ;" );            $msql->query( "CREATE TABLE IF NOT EXISTS ".$TablePre."_tools_photopollindex (\r\n  `id` int(11) NOT NULL auto_increment,\r\n  `catid` int(12) NOT NULL,\r\n  `catpath` char(255) default NULL,\r\n  `cat` varchar(100) NOT NULL,\r\n  `groupname` varchar(100) NOT NULL default '',\r\n  `timestamp` int(11) NOT NULL default '0',\r\n  `status` smallint(2) NOT NULL default '0',\r\n  `exp_time` int(11) NOT NULL default '0',\r\n  `expire` smallint(2) NOT NULL default '0',\r\n  PRIMARY KEY  (`id`)\r\n) ENGINE=MyISAM DEFAULT CHARSET=utf8 AUTO_INCREMENT=1 ;" );        }        if ( $release == "20090615" )        {            global $msql;            $msql->query( "CREATE TABLE IF NOT EXISTS ".$TablePre."_base_adminauth (\r\n  `id` int(6) NOT NULL auto_increment,\r\n  `coltype` varchar(30) NOT NULL,\r\n  `auth` int(5) NOT NULL default '0',\r\n  `name` char(50) NOT NULL default '',\r\n  `intro` char(255) NOT NULL default '',\r\n  `xuhao` int(10) NOT NULL default '0',\r\n  `pid` int(10) NOT NULL default '0',\r\n  `pname` char(20) NOT NULL default '',\r\n  PRIMARY KEY  (`id`)\r\n) ENGINE=MyISAM  DEFAULT CHARSET=utf8 AUTO_INCREMENT=236 ;" );            $msql->query( "INSERT INTO ".$TablePre."_base_adminauth (`id`, `coltype`, `auth`, `name`, `intro`, `xuhao`, `pid`, `pname`) VALUES\r\n(212, 'member', 67, '财务收款入账', '', 16, 6, ''),\r\n(213, 'member', 68, '会员帐务查询', '', 16, 6, '');" );            $msql->query( "CREATE TABLE IF NOT EXISTS ".$TablePre."_member_buylist (\r\n  `id` int(12) NOT NULL auto_increment,\r\n  `buyfrom` varchar(50) NOT NULL default '',\r\n  `memberid` int(12) NOT NULL default '0',\r\n  `orderid` int(12) NOT NULL default '0',\r\n  `payid` int(12) NOT NULL default '0',\r\n  `paytype` varchar(50) NOT NULL default '0',\r\n  `payhb` varchar(30) NOT NULL default '',\r\n  `payhl` decimal(12,4) NOT NULL default '0.0000',\r\n  `paytotal` decimal(12,2) NOT NULL default '0.00',\r\n  `daytime` int(11) NOT NULL default '0',\r\n  `ip` varchar(20) NOT NULL default '',\r\n  `OrderNo` varchar(30) NOT NULL default '',\r\n  `logname` varchar(50) NOT NULL default '',\r\n  PRIMARY KEY  (`id`)\r\n) ENGINE=MyISAM  DEFAULT CHARSET=utf8 AUTO_INCREMENT=4 ;" );            $msql->query( "INSERT INTO ".$TablePre."_member_buylist (`id`, `buyfrom`, `memberid`, `orderid`, `payid`, `paytype`, `payhb`, `payhl`, `paytotal`, `daytime`, `ip`, `OrderNo`, `logname`) VALUES\r\n(1, '网上购物', 155, 1, 2, '送货上门收款', '', 0.0000, 396014.00, 1265618662, '192.168.1.123', '100001', '管理员'),\r\n(2, '网上购物', 155, 1, 0, '订单退款', '', 0.0000, -396014.00, 1265704645, '192.168.1.123', '100001', '管理员'),\r\n(3, '网上购物', 161, 8, 2, '送货上门收款', '', 0.0000, 330.00, 1322719652, '127.0.0.1', '100008', '管理员');" );            $msql->query( "CREATE TABLE IF NOT EXISTS ".$TablePre."_member_pay (\r\n  `id` int(11) NOT NULL auto_increment,\r\n  `memberid` int(20) NOT NULL default '0',\r\n  `payid` int(11) NOT NULL default '0',\r\n  `payhb` varchar(30) NOT NULL default '',\r\n  `payhl` decimal(12,4) NOT NULL default '0.0000',\r\n  `oof` decimal(12,2) NOT NULL default '0.00',\r\n  `method` varchar(200) NOT NULL default '',\r\n  `type` varchar(50) NOT NULL default '',\r\n  `addtime` int(11) NOT NULL default '0',\r\n  `fpnum` varchar(100) NOT NULL default '',\r\n  `memo` varchar(255) NOT NULL default '',\r\n  `ip` varchar(20) NOT NULL default '',\r\n  `logname` varchar(50) NOT NULL default '',\r\n  PRIMARY KEY  (`id`)\r\n) ENGINE=MyISAM  DEFAULT CHARSET=utf8 AUTO_INCREMENT=3 ;" );            $msql->query( "INSERT INTO ".$TablePre."_member_pay (`id`, `memberid`, `payid`, `payhb`, `payhl`, `oof`, `method`, `type`, `addtime`, `fpnum`, `memo`, `ip`, `logname`) VALUES\r\n(1, 155, 2, '', 0.0000, 396014.00, '送货上门收款', '收款确认', 1265618662, '', '', '192.168.1.123', '管理员'),\r\n(2, 161, 2, '', 0.0000, 330.00, '送货上门收款', '收款确认', 1322719652, '', '', '127.0.0.1', '管理员');" );            $msql->query( "CREATE TABLE IF NOT EXISTS ".$TablePre."_member_paycenter (\r\n  `id` int(11) NOT NULL auto_increment,\r\n  `pcenter` varchar(100) NOT NULL default '',\r\n  `pcentertype` int(2) NOT NULL default '0',\r\n  `pcenteruser` varchar(100) NOT NULL default '',\r\n  `pcenterkey` text,\r\n  `key1` text,\r\n  `key2` text,\r\n  `hbtype` varchar(255) NOT NULL default '',\r\n  `postfile` varchar(100) NOT NULL default '',\r\n  `recfile` varchar(100) NOT NULL default '',\r\n  `ifuse` int(1) NOT NULL default '0',\r\n  `ifback` int(1) NOT NULL default '0',\r\n  `intro` text,\r\n  `xuhao` int(5) NOT NULL default '0',\r\n  PRIMARY KEY  (`id`)\r\n) ENGINE=MyISAM  DEFAULT CHARSET=utf8 AUTO_INCREMENT=3 ;" );            $msql->query( "INSERT INTO ".$TablePre."_member_paycenter (`id`, `pcenter`, `pcentertype`, `pcenteruser`, `pcenterkey`, `key1`, `key2`, `hbtype`, `postfile`, `recfile`, `ifuse`, `ifback`, `intro`, `xuhao`) VALUES\r\n(1, '支付宝', 1, '2088002053153634', '9fkjby5pbzscg61vil4pf6xwlp8b9w6d', 'wangjinmin1982@126.com', '', 'alipay_db', 'alipay_db_post.php', 'alipay_db_rec.php', 1, 1, '支付宝担保交易', 0),\r\n(2, '送货上门收款', 0, '', '', '', '', '', '', '', 1, 1, '限本地送货上门收款', 1);" );        }        if ( $release == "20090728" )        {            global $msql;            $msql->query( "INSERT INTO ".$TablePre."_base_adminauth (`id`, `coltype`, `auth`, `name`, `intro`, `xuhao`, `pid`, `pname`) VALUES\r\n(215, 'member', 70, '帐务查询统计', '', 16, 6, '');" );        }        if ( $release == "20091009" )        {            global $msql;            $msql->query( "INSERT INTO ".$TablePre."_base_adminauth (`id`, `coltype`, `auth`, `name`, `intro`, `xuhao`, `pid`, `pname`) VALUES\r\n(214, 'member', 69, '支付方法设置', '', 16, 6, '');" );            $msql->query( "CREATE TABLE IF NOT EXISTS ".$TablePre."_member_onlinepay (\r\n  `id` int(11) NOT NULL auto_increment,\r\n  `memberid` int(20) NOT NULL default '0',\r\n  `payid` int(11) NOT NULL default '0',\r\n  `paytype` char(30) NOT NULL default '',\r\n  `paytotal` decimal(10,2) NOT NULL default '0.00',\r\n  `ifpay` int(1) NOT NULL default '0',\r\n  `addtime` int(11) NOT NULL default '0',\r\n  `backtime` int(11) NOT NULL default '0',\r\n  `ip` varchar(20) NOT NULL default '',\r\n  PRIMARY KEY  (`id`)\r\n) ENGINE=MyISAM  DEFAULT CHARSET=utf8 AUTO_INCREMENT=3 ;" );            $msql->query( "INSERT INTO ".$TablePre."_member_onlinepay (`id`, `memberid`, `payid`, `paytype`, `paytotal`, `ifpay`, `addtime`, `backtime`, `ip`) VALUES\r\n(1, 156, 1, '支付宝', 1.00, 0, 1263868579, 0, '192.168.1.18'),\r\n(2, 155, 1, '支付宝', 1.00, 0, 1265701509, 0, '192.168.1.18');" );        }        if ( $release == "20100920" )        {            global $msql;            $msql->query( " alter  table ".$TablePre."_advs_lb       \r\n  add   src1  varchar(100)" );        }        if ( $release == "20100925" )        {            global $msql;            $msql->query( " alter  table ".$TablePre."_news_con       \r\n  add   tourl  varchar(100)" );        }        $FromPath = "../update/".$release;        $ToPath = "../";        cpfolder( $FromPath, $ToPath );        $msql->query( "update ".$TablePre."_base_config set `value`='{$user}' where `variable`='phpwebUser'" );        $msql->query( "INSERT INTO  ".$TablePre."_base_version (`version`, `release`)  VALUES   ('{$version}' ,'{$release}') " );        $msql->query( "INSERT INTO  ".$TablePre."_base_version (`version`, `release`)  VALUES   ('{$version}' ,'{$release}') " );        echo "OK";        exit( );        break;}